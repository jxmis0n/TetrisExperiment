<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Tetris vs CPU</title>
  <style>
    /* === SCORE PILLS & LEAD === */
    #scoreBars { text-align:center; background:#eee; padding:10px 0; position:relative; }
    .pill {
      display:inline-block; margin:5px;
      padding:8px 24px; border-radius:20px;
      color:#fff; font-weight:bold; font-size:18px;
      position:relative;
      transition:background 0.3s;
    }
    .pill.red { background: linear-gradient(90deg,maroon,red); }
    .pill.blue{ background: linear-gradient(90deg,navy,blue); }
    #cpuPill span:first-child { display:block; font-size:14px; color:#000; margin-bottom:4px; }
    #playerPill span:first-child { display:block; font-size:14px; color:#000; margin-bottom:4px; }
    #leadText {
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%) rotate(-15deg);
      font-size:36px; color:deeppink; text-shadow:0 0 8px hotpink;
      display:none; z-index:10;
      animation:leadShake 0.1s infinite alternate;
    }
    @keyframes leadShake {
      from{ transform:translate(-3px,-3px) rotate(-15deg); }
      to  { transform:translate( 3px, 3px) rotate(-15deg); }
    }

    /* === TETRIS AREA === */
    #tetrisWrapper {
      display:flex; justify-content:center; align-items:flex-start;
      gap:20px; margin:20px auto; max-width:640px;
      position:relative;
    }
    canvas {
      background:#000; box-shadow:0 0 8px rgba(0,0,0,0.5);
    }
    canvas.player { border:4px solid blue; }
    canvas.cpu    { border:4px solid red; }

    /* === HOLD & CONTROLS LEGEND === */
    #controls {
      max-width:640px; margin:10px auto; font-family:sans-serif; text-align:center;
    }
    #holdBox {
      display:inline-block; width:80px; height:80px;
      border:2px solid #000; margin-right:20px;
      vertical-align:top;
    }
    #controlsText {
      display:inline-block; text-align:left; font-size:14px;
      vertical-align:top; line-height:1.4;
    }

    /* === MOBILE TOUCH BUTTONS === */
    #mobileControls {
      display:none; max-width:640px; margin:20px auto; text-align:center;
    }
    #mobileControls button {
      width:60px; height:60px; margin:5px;
      font-size:24px; border:none; background:#444; color:#fff;
      border-radius:8px;
    }

    /* === TETRIS ALERT === */
    #tetrisOverlay {
      position:absolute; top:40%; left:50%;
      transform:translate(-50%,-50%);
      font-size:48px; color:yellow; text-shadow:0 0 10px orange;
      z-index:5; display:none;
    }

    /* === COUNTDOWN === */
    #countdownOverlay {
      position:absolute; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.8); color:#fff;
      font-size:100px; display:flex;
      align-items:center; justify-content:center;
      z-index:20; visibility:hidden;
    }

    /* === RESPONSIVE RULES === */
    @media (max-width:600px) {
      #tetrisWrapper { flex-direction:column; align-items:center; }
      /* If High comp -> both canvases but resizing done in JS */
      /* If Low comp -> CPU canvas hidden by JS */
      #mobileControls { display:flex; justify-content:center; flex-wrap:wrap; }
    }
  </style>
</head>
<body>
  <!-- Score Pills -->
  <div id="scoreBars">
    <div id="cpuPill" class="pill red">
      <span id="cpuScorePill">0 pts</span>
      <span id="cpuNamePill">ASH</span>
    </div>
    <div id="playerPill" class="pill blue">
      <span id="playerScorePill">0 pts</span>
      <span>PLAYER</span>
    </div>
    <div id="leadText">TAKES THE LEAD!!</div>
  </div>

  <!-- Countdown -->
  <div id="countdownOverlay">3</div>
  <!-- Tetris Alert -->
  <div id="tetrisOverlay">WOW TETRIS!</div>

  <!-- Tetris Boards -->
  <div id="tetrisWrapper">
    <canvas id="playerCanvas" class="player" width="300" height="600"></canvas>
    <canvas id="cpuCanvas"    class="cpu"    width="300" height="600"></canvas>
  </div>

  <!-- Hold + Controls Legend -->
  <div id="controls">
    <div id="holdBox">
      <canvas id="holdCanvas" width="80" height="80"></canvas>
    </div>
    <div id="controlsText">
      Controls:<br/>
      A / ← = Left D / → = Right<br/>
      S / ↓ = Soft Drop Shift = Rotate<br/>
      Space = Hard Drop C = Hold
    </div>
  </div>

  <!-- On‐Screen Touch Buttons -->
  <div id="mobileControls">
    <button data-cmd="moveLeft">⟵</button>
    <button data-cmd="moveDown">⟵</button>
    <button data-cmd="moveRight">⟶</button>
    <button data-cmd="rotate">⟳</button>
    <button data-cmd="hardDrop">⤵</button>
    <button data-cmd="hold">H</button>
  </div>

  <script>
  (function(){
    // --- 1) Parameter & device sniffing ---
    const params = new URLSearchParams(location.search);
    const competition = (params.get('competition')||'Low').toLowerCase();
    const isMobile = /Mobi|Android|iPhone/i.test(navigator.userAgent);

    // --- 2) Assign random CPU name ---
    const names = ['Ash','Jordan','Riley','Taylor'];
    const cpuName = names[Math.floor(Math.random()*names.length)];
    document.getElementById('cpuNamePill').textContent = cpuName;

    // --- 3) Adjust UI for mobile + competition ---
    const cpuCanvas   = document.getElementById('cpuCanvas');
    const playerCanvas= document.getElementById('playerCanvas');
    const mobileCtrls = document.getElementById('mobileControls');
    if(isMobile) {
      mobileCtrls.style.display='flex';
      if(competition==='low') {
        cpuCanvas.style.display='none';
      } else {
        // high: make CPU canvas smaller
        playerCanvas.style.width='80%';
        cpuCanvas.style.width   ='50%';
      }
    }

    // --- 4) Tetris logic (simplified for brevity) ---
    const COLS=10, ROWS=20, CELL=30;
    const SHAPES = { /* same as before */ };
    const COLORS = { /* same as before */ };
    // heuristics, Board class, etc. (use code from prior versions),
    // but set CPU dropInterval:
    //    let cpuSpeed = competition==='high'? 200:800;

    // *** Paste your full TetrisBoard class here, but in the constructor ***
    //    this.dropInterval = (mode==='cpu'?cpuSpeed:500);

    // --- 5) Game Loop & UI hooks ---
    // instantiate:
    window.player = new TetrisBoard('playerCanvas','human');
    window.cpu    = new TetrisBoard('cpuCanvas','cpu');
    // pass cpuName into both consoles if you draw text.

    // Countdown
    const cd = document.getElementById('countdownOverlay');
    let cnt=3;
    cd.style.visibility='visible';
    const cdI = setInterval(()=>{
      cnt--;
      if(cnt>0) cd.textContent=cnt;
      else{ clearInterval(cdI); cd.style.visibility='hidden'; last=performance.now(); requestAnimationFrame(frame);}
    },1000);

    // Touch button binding
    mobileCtrls.querySelectorAll('button').forEach(b=>{
      b.addEventListener('click',()=> {
        const cmd=b.dataset.cmd;
        if(!player.gameOver){
          switch(cmd){
            case 'moveLeft':  player.move(-1,0); break;
            case 'moveRight': player.move(1,0);  break;
            case 'moveDown':  player.move(0,1);  break;
            case 'rotate':    player.rotate();   break;
            case 'hardDrop':  player.hardDrop(); break;
            case 'hold':      player.hold();     break;
          }
        }
      });
    });

    // Keyboard binding (desktop)
    document.addEventListener('keydown',e=>{
      if(player.gameOver) return;
      switch(e.key){
        case 'a': case 'ArrowLeft':  player.move(-1,0); break;
        case 'd': case 'ArrowRight': player.move(1,0);  break;
        case 's': case 'ArrowDown':  player.move(0,1);  break;
        case ' ':                   player.hardDrop();  break;
        case 'c':                   player.hold();      break;
      }
      if(e.code==='ShiftLeft'||e.code==='ShiftRight') player.rotate();
    });

    // Score bars & lead flash
    function updateScores(pScore,cScore){
      const pr = document.getElementById('playerScorePill'),
            cr = document.getElementById('cpuScorePill');
      pr.textContent = pScore+' pts';
      cr.textContent = cScore+' pts';
      // shake above 500, lead detection...
      // same logic as before
    }

    // frame() loop: update(), draw(), exchange garbage, updateScores, flashLead, tetrisOverlay on 4-line clear

  })();
  </script>
</body>
</html>
